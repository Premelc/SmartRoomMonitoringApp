<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/popup.css">

    <link rel=”stylesheet” href=”https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css”rel=”nofollow” integrity=”sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I” crossorigin=”anonymous”>
    <title>Dashboard</title>
</head>
<body>
    <div class="navbar">
        <button class="openbtn" onclick="toggleNav()" id="openBtnId">☰ Quick Access</button>
        <a href="index.html"><div class="navbuttons">
            HOME
        </div></a>
        <div class="navbuttons">
            SEARCH
        </div>
        <div class="navbuttons">
            DHMZ
        </div>

        <div class="logo">
            <img src="./img/logo.gif">
        </div>

        <div class="navbuttons">
            WARNINGS
        </div>

        <div class="navbuttons">
            NOTIFICATIONS
        </div>

        <div class="navbuttons">
            ADRIA
        </div>
        <div id="userLoc"  class="navbuttons">
            <b><u>CURRENT ROOM STATE</u></b>
        </div>
    </div>
<div class="outer" id="main">

    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
        <a href="#">About</a>
        <a href="#">Services</a>
        <a href="#">Clients</a>
        <a href="#" onclick="openRoomOnDayForm()">Room status on day</a>
        <a href="#" onclick="openRoomArchiveStatusForm()">Room history</a>
        <a href="#" onclick="openRoomStatusForm()">Room status</a>
    </div>

            <div class = "main" id="middle">

                <div class="Popup">
                    <div class="formPopup" id="roomArchiveStatusForm">
                        <form action="PLACEHOLDER" class="formContainer">
                            <h2>Check archive for room </h2>
                            <label for="roomNum">
                                <strong>Room Number</strong>
                            </label>
                            <input type="text" id="roomNum2" placeholder="123" name="Room Number" required maxlength="3">
                            <label for="dateFrom">
                                <strong>Date from</strong>
                            </label>
                            <input type="date" id="dateFrom" placeholder="dd/mm/yyyy" name = "Date From" required>
                            <label for="dateTo">
                                <strong>Date To</strong>
                            </label>
                            <input type="date" id="dateTo" placeholder="dd/mm/yyyy" name = "Date To" required>

                            <button type="submit" class="btn">Check</button>
                            <button type="button" class="btn cancel" onclick="closeRoomArchiveStatusForm()">Close</button>
                        </form>
                    </div>

                    <div class="formPopup" id="roomStatusForm">
                        <div class="formContainer">
                            <h2>Check room status</h2>
                            <label for="roomNum">
                                <strong>Room Number</strong>
                            </label>
                            <input type="text" id="roomNum" placeholder="123" name="Room Number" required maxlength="3">
                            <button type="button" class="btn" onclick="getCurrentRoomState(document.getElementById('roomNum').value)" >Check Status</button>
                            <button type="button" class="btn cancel" onclick="closeRoomStatusForm()">Close</button>
                        </div>
                    </div>

                    <div class="formPopup" id="roomStatusOnDay">
                        <div class="formContainer">
                            <h2>Check room status on day</h2>
                            <label for="roomNum">
                                <strong>Room Number</strong>
                            </label>
                            <input type="text" id="roomOnDay" placeholder="123" name="Room Number" required maxlength="3">
                            <input type="date" id="dateOn" placeholder="dd/mm/yyyy" name = "Date On" required>
                            <button type="button" class="btn" onclick="roomStateOnDay(document.getElementById('roomOnDay').value , document.getElementById('dateOn').value)" >Check Status</button>
                            <button type="button" class="btn cancel" onclick="closeRoomOnDayForm()">Close</button>
                        </div>
                    </div>

                    <div class="formPopup" id="popupRoomState">

                    </div>

                </div>
                <h1>MAIN ADRIA DATA</h1>
                <div id="left">
                    <button>test</button>
                </div>

            </div>

            <div class = "right" id="right">

            </div>
    <div class="bottombar">

    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        //posljednje stanje sobe
        async function fetchData(roomId){
            try {
                const response = await axios.get(`http://localhost:8080/adria/${roomId}`)
                console.log(response)
                return response.data;
            }
            catch (e){
                console.log(e)
            }
        }
        //posljednje stanje dhmz
        async function fetchCurrentDHMZ(){
            try {
                const response = await axios.get(`http://localhost:8080/dhmz/latest`)
                console.log(response)
                return response.data;
            }
            catch (e){
                console.log(e)
            }
        }
        //Ocitanja unutar 24h
        async function fetchRoomReadingsOnDay(roomId , time){
            try {
                const readings = await axios.get(`http://localhost:8080/adria/${roomId}/at/${time}`)
                return readings.data;
            }
            catch (e){
                console.log(e)
            }
        }

        async function fetchExactRoomReading(roomId , time){
            try {
                const reading = await axios.get(`http://localhost:8080/adria/${roomId}/${time}`)
                return reading.data;
            }
            catch (e){
                console.log(e)
            }
        }

        async function ExactRoomReading(roomId , time){
            var myDate = new Date(time);
            var milis = myDate.getTime();
            const data2 = await fetchExactRoomReading(roomId , milis);
            console.log(data2);
            let data = JSON.parse(data2);
            var popup = document.getElementById("popupRoomState");
            popup.innerHTML = "";

            var button = document.createElement("div");
            button.innerHTML =`
                <button type='button' class='btn cancel' onclick='closePopupRoomState()'>Close</button>
                `;

            var dataDiv = document.createElement("div");
            const date = new Date(data.vrijeme).toLocaleString('hr-HR' , { timeZone: 'CET' });
            dataDiv.innerHTML = `
                    <h1>Room number : <span id="currentRoomId2">${roomId}</span></h1>
        <h2 >Vrijeme : ${date}</h2>
        <h2 >Prisutnost : ${data.prisutnost}</h2>
        <h2 >Zadana temperatura : ${data.zadana}</h2>
        <h2 >Izmjerena temperatura : ${data.izmjerena}</h2>
        <h2 >Status klime : ${data.statusKlime}</h2>
        <h2 >Mod klime : ${data.modKlime}</h2>
        <h2 >Prozor : ${data.prozor}</h2>
        <h2 >Ventil : ${data.ventil}</h2>
        <h2 >WC set : ${data.wcSet}</h2>
        <h2 >WC mjerenja : ${data.wcMjerenja}</h2>
            `;

            popup.appendChild(dataDiv);
            popup.appendChild(button);

            openPopupRoomState();
        }

        async function roomStateOnDay(roomId , time){
            var myDate = new Date(time);
            var milis = myDate.getTime();
            var data = await fetchRoomReadingsOnDay(roomId , milis);

            document.getElementById("left").innerHTML = "";

            var roomNum = document.createElement("h2");
            roomNum.innerHTML = `
            Room number: <span id="roomNum2">${roomId}</span>
`;

            document.getElementById("left").appendChild(roomNum);

            const roomNumber = roomId;
            const list = document.createElement("ol");
            for(let i in data){
                let item = document.createElement("li");
                let it = JSON.parse(data[i]);
                const date = new Date(it.vrijeme).toLocaleString('hr-HR' , { timeZone: 'CET' });


                item.innerHTML = `
                <a id="${it.vrijeme}" onclick="ExactRoomReading('${roomNumber}' , ${it.vrijeme})">Timestamp: <b>${date}</b></a>

                `;

                list.appendChild(item);
            }

            document.getElementById("left").appendChild(list);

           closeRoomOnDayForm();
        }



        async function getCurrentRoomState(roomId){
            const data = await fetchData(roomId);
            const date = new Date(data.vrijeme).toLocaleString('hr-HR' , { timeZone: 'CET' });
            document.getElementById("left").innerHTML =`
        <h1>Room number : <span id="currentRoomId">${roomId}</span></h1>
        <h2 >Vrijeme : ${date}</h2>
        <h2 >Prisutnost : ${data.prisutnost}</h2>
        <h2 >Zadana temperatura : ${data.zadana}</h2>
        <h2 >Izmjerena temperatura : ${data.izmjerena}</h2>
        <h2 >Status klime : ${data.statusKlime}</h2>
        <h2 >Mod klime : ${data.modKlime}</h2>
        <h2 >Prozor : ${data.prozor}</h2>
        <h2 >Ventil : ${data.ventil}</h2>
        <h2 >WC set : ${data.wcSet}</h2>
        <h2 >WC mjerenja : ${data.wcMjerenja}</h2>
`;
            const dhmz = await fetchCurrentDHMZ()

            document.getElementById("right").innerHTML =`
        <h1>DHMZ DATA</h1>
        <h3>Trenutno stanje: </h3>
        <h2>Vrijeme : ${dhmz.vrijeme}</h2>
        <h2 >Zračenje : ${dhmz.zracenje}</h2>
        <h2 >Temperatura : ${dhmz.temperatura}</h2>
        <h2 >Smjer vjetra : ${dhmz.smjerVjetra}</h2>
       <h2 >Brzina vjetra : ${dhmz.brzinaVjetra}</h2>
       <h2 >Vlaznost : ${dhmz.vlaznost}</h2>
    </h2>
`;

            closeRoomStatusForm();
        }
    </script>


    <script src="./javascript/sidebar.js">
    </script>
    <script src="./javascript/LeftWindow.js">
    </script>



</body>
</html>